
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UCS + Map Routing Demo</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Your external CSS -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* SVG STYLING FROM UCS DEMO */
    svg.graph { width: 380px; height: 260px; border: 1px solid #ccc; background: #fafafa; }
    .edge {
      stroke: #bbb; stroke-width: 6; stroke-linecap: round;
      transition: stroke 200ms, stroke-width 200ms, opacity 200ms;
    }
    .node {
      fill: #fff; stroke: #333; stroke-width: 2;
      transition: fill 200ms, stroke 200ms;
    }
    .node-label { font-size: 12px; text-anchor: middle; dominant-baseline: middle; }

    .dim { opacity: 0.25; }
    .active-edge { stroke: #007bff !important; stroke-width: 8 !important; opacity: 1 !important; }
    .active-node { fill: #007bff !important; stroke: #004a99 !important; }
  </style>

</head>
<body>

  <div id="app">
    <div id="map"></div>

    <div id="sidebar">

      <h2>UCS + Map Routing Demo</h2>
      <p class="small">Click on the map to set start/end or enter coordinates manually.</p>

      <label>Start coordinates (lat,lon)</label>
      <input id="startInput" placeholder="Select start" />
      <button id="setStartBtn">Set Start (click on map)</button>

      <label>End coordinates (lat,lon)</label>
      <input id="endInput" placeholder="Select end" />
      <button id="setEndBtn">Set End (click on map)</button>

      <div style="margin-top:8px">
        <button id="routeBtn">Find Route</button>
        <button id="clearBtn">Clear Route</button>
      </div>

      <div id="routeInfo" class="info"></div>

      <hr />
      <h3>Uniform-Cost Search (demo)</h3>

      <label>UCS start</label>
      <input id="ucsStart" value="0">

      <label>UCS goal</label>
      <input id="ucsGoal" value="9">

      <label>Graph input (from to cost)</label>
      <textarea id="graphInput" rows="8">0 1 1
1 2 1
0 3 1
1 4 1
2 5 1
3 4 1
4 5 1
5 6 1
3 7 1
4 8 1
5 9 1
7 8 1
8 9 1
</textarea>

      <button id="runUCS">Run UCS</button>

      <div id="ucsResult" class="info"></div>

      <!-- SVG GRAPH (option A: placed just below result) -->
      <svg class="graph" viewBox="0 0 350 230">

        <!-- EDGES -->
        <line id="e-0-1" class="edge" x1="50" y1="40" x2="150" y2="40"/>
        <line id="e-1-2" class="edge" x1="150" y1="40" x2="250" y2="40"/>

        <line id="e-0-3" class="edge" x1="50" y1="40" x2="20" y2="100"/>
        <line id="e-1-4" class="edge" x1="150" y1="40" x2="120" y2="100"/>
        <line id="e-2-5" class="edge" x1="250" y1="40" x2="220" y2="100"/>

        <line id="e-3-4" class="edge" x1="20" y1="100" x2="120" y2="100"/>
        <line id="e-4-5" class="edge" x1="120" y1="100" x2="220" y2="100"/>
        <line id="e-5-6" class="edge" x1="220" y1="100" x2="320" y2="100"/>

        <line id="e-3-7" class="edge" x1="20" y1="100" x2="50" y2="160"/>
        <line id="e-4-8" class="edge" x1="120" y1="100" x2="150" y2="160"/>
        <line id="e-5-9" class="edge" x1="220" y1="100" x2="250" y2="160"/>

        <line id="e-7-8" class="edge" x1="50" y1="160" x2="150" y2="160"/>
        <line id="e-8-9" class="edge" x1="150" y1="160" x2="250" y2="160"/>

        <!-- NODES -->
        <circle id="n-0" class="node" cx="50" cy="40" r="12"/><text x="50" y="40" class="node-label">0</text>
        <circle id="n-1" class="node" cx="150" cy="40" r="12"/><text x="150" y="40" class="node-label">1</text>
        <circle id="n-2" class="node" cx="250" cy="40" r="12"/><text x="250" y="40" class="node-label">2</text>

        <circle id="n-3" class="node" cx="20" cy="100" r="12"/><text x="20" y="100" class="node-label">3</text>
        <circle id="n-4" class="node" cx="120" cy="100" r="12"/><text x="120" y="100" class="node-label">4</text>
        <circle id="n-5" class="node" cx="220" cy="100" r="12"/><text x="220" y="100" class="node-label">5</text>
        <circle id="n-6" class="node" cx="320" cy="100" r="12"/><text x="320" y="100" class="node-label">6</text>

        <circle id="n-7" class="node" cx="50" cy="160" r="12"/><text x="50" y="160" class="node-label">7</text>
        <circle id="n-8" class="node" cx="150" cy="160" r="12"/><text x="150" y="160" class="node-label">8</text>
        <circle id="n-9" class="node" cx="250" cy="160" r="12"/><text x="250" y="160" class="node-label">9</text>

      </svg>

    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// --------------------------------------------------
// MAP CODE (UNCHANGED)
// --------------------------------------------------

const map = L.map('map').setView([20.5937, 78.9629], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '© OpenStreetMap contributors'
}).addTo(map);

let startMarker = null, endMarker = null, routeLayer = null;
let selecting = null;

const startInput = document.getElementById("startInput");
const endInput = document.getElementById("endInput");

document.getElementById("setStartBtn").onclick = () => {
  selecting = "start"; alert("Click on the map to choose the Start point");
};
document.getElementById("setEndBtn").onclick = () => {
  selecting = "end"; alert("Click on the map to choose the End point");
};

map.on("click", e => {
  if (!selecting) return;

  const lat = e.latlng.lat.toFixed(6);
  const lon = e.latlng.lng.toFixed(6);

  if (selecting === "start") {
    startInput.value = `${lat},${lon}`;
    if (startMarker) map.removeLayer(startMarker);
    startMarker = L.marker([lat, lon]).addTo(map);
  } else {
    endInput.value = `${lat},${lon}`;
    if (endMarker) map.removeLayer(endMarker);
    endMarker = L.marker([lat, lon]).addTo(map);
  }

  selecting = null;
});

// ORS routing (unchanged)
async function callORSRoute(lat1, lon1, lat2, lon2) {
  const API_KEY = "eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImZjNDVhODk3MmMxZDRiMDc4ZjUzM2RiMTFkODU2MThhIiwiaCI6Im11cm11cjY0In0=";

  const url = "https://api.openrouteservice.org/v2/directions/driving-car/geojson";
  const body = { coordinates: [[lon1, lat1], [lon2, lat2]] };

  document.getElementById("routeInfo").innerHTML = "Routing...";

  try {
    const res = await fetch(url, {
      method: "POST",
      headers: {
        "Authorization": API_KEY,
        "Content-Type": "application/json"
      },
      body: JSON.stringify(body)
    });

    const data = await res.json();
    console.log("ORS Full Response:", data);

    // Remove previous route layer
    if (routeLayer) map.removeLayer(routeLayer);

    // ORS returns features[] (each = one possible route)
    const routes = data.features;
    if (!routes || routes.length === 0) {
      document.getElementById("routeInfo").innerHTML = "No routes found";
      return;
    }

    // Draw all available routes
    routes.forEach((route, i) => {
      const coords = route.geometry.coordinates.map(c => [c[1], c[0]]);

      const color = i === 0 ? "red" : "blue"; // red = shortest, others = blue
      const weight = i === 0 ? 6 : 3;

      const layer = L.polyline(coords, { color, weight }).addTo(map);

      // Store only the main route layer
      if (i === 0) routeLayer = layer;
    });

    // Show info text
    const dist = (routes[0].properties.summary.distance / 1000).toFixed(2);
    const time = (routes[0].properties.summary.duration / 60).toFixed(1);

    document.getElementById("routeInfo").innerHTML =
      `Shortest Route: ${dist} km — ${time} min<br>
       Total Available Routes: ${routes.length}`;

  } catch (err) {
    document.getElementById("routeInfo").innerHTML = "Error: " + err.message;
  }
}


document.getElementById("routeBtn").onclick = () => {
  const s=startInput.value.trim(), e=endInput.value.trim();
  if(!s||!e) return alert("Enter both start and end");
  const [slat,slon]=s.split(",").map(Number);
  const [elat,elon]=e.split(",").map(Number);
  callORSRoute(slat,slon,elat,elon);
};

document.getElementById("clearBtn").onclick = () => {
  if(routeLayer) map.removeLayer(routeLayer);
  if(startMarker) map.removeLayer(startMarker);
  if(endMarker) map.removeLayer(endMarker);
  routeLayer=startMarker=endMarker=null;
  document.getElementById("routeInfo").innerHTML="";
};

// --------------------------------------------------
// UCS SYSTEM WITH SVG GRAPH (MERGED)
// --------------------------------------------------

function parseGraph(text){
  const graph={};
  text.split("\n").forEach(l=>{
    const p=l.trim().split(/\s+/);
    if(p.length<3) return;
    const [u,v,c]=p;
    const cost=+c;
    if(!graph[u]) graph[u]=[];
    if(!graph[v]) graph[v]=[];
    graph[u].push({node:v,cost});
    graph[v].push({node:u,cost});
  });
  return graph;
}

function UCS(graph,start,goal){
  const frontier=[{node:start,cost:0,path:[start]}];
  const best={};

  while(frontier.length){
    frontier.sort((a,b)=>a.cost-b.cost);
    const cur=frontier.shift();
    if(cur.node===goal) return cur;
    if(best[cur.node]!==undefined && best[cur.node]<cur.cost) continue;
    best[cur.node]=cur.cost;
    for(const nb of graph[cur.node]||[]){
      frontier.push({node:nb.node,cost:cur.cost+nb.cost,path:[...cur.path,nb.node]});
    }
  }
  return null;
}

function resetSvg(){
  document.querySelectorAll(".edge").forEach(e=>{
    e.classList.remove("active-edge","dim");
    e.style.stroke="#bbb";
  });
  document.querySelectorAll(".node").forEach(n=>{
    n.classList.remove("active-node","dim");
    n.style.fill="#fff";
  });
}

function edgeId(a,b){
  a=String(a); b=String(b);
  return (a<b)?`e-${a}-${b}`:`e-${b}-${a}`;
}

function highlightPath(path){
  resetSvg();
  if(!path) return;

  document.querySelectorAll(".edge").forEach(e=>e.classList.add("dim"));
  document.querySelectorAll(".node").forEach(n=>n.classList.add("dim"));

  for(let i=0;i<path.length;i++){
    const n=document.getElementById("n-"+path[i]);
    if(n){ n.classList.remove("dim"); n.classList.add("active-node"); }

    if(i<path.length-1){
      const id=edgeId(path[i],path[i+1]);
      const e=document.getElementById(id);
      if(e){ e.classList.remove("dim"); e.classList.add("active-edge"); }
    }
  }
}

document.getElementById("runUCS").onclick = () => {
  const graph=parseGraph(document.getElementById("graphInput").value);
  const s=document.getElementById("ucsStart").value.trim();
  const g=document.getElementById("ucsGoal").value.trim();

  const result=UCS(graph,s,g);

  if(result){
    document.getElementById("ucsResult").innerHTML=
      `Path: ${result.path.join(" → ")}<br>Cost: ${result.cost}`;
    highlightPath(result.path);
  } else {
    document.getElementById("ucsResult").innerHTML="No path found";
    resetSvg();
  }
};
</script>

</body>
</html>
